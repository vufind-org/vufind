<?
  $this->headTitle($this->translate('Browse the Collection Alphabetically'));
  $this->layout()->breadcrumbs = '<a href="' . $this->url('alphabrowse-home') . '">' . $this->transEsc('Browse Alphabetically') . '</a>';
  $baseQuery = array('source' => $this->source, 'from' => $this->from);
?>

<? /* LOAD THE LINK INFORMATION INTO $pageLinks, similar to smarty's {capture} */ ?>
<? ob_start(); ?>
  <div class="alphaBrowsePageLinks">
    <? if (isset($this->prevpage)): ?>
      <div class="alphaBrowsePrevLink"><a href="<?=$this->escapeHtmlAttr($this->url('alphabrowse-home', array(), array('query' => $baseQuery + array('page' => $this->prevpage))))?>">&laquo; <?=$this->transEsc('Prev')?></a></div>
    <? endif; ?>

    <? if (isset($this->nextpage)): ?>
      <div class="alphaBrowseNextLink"><a href="<?=$this->escapeHtmlAttr($this->url('alphabrowse-home', array(), array('query' => $baseQuery + array('page' => $this->nextpage))))?>"><?=$this->transEsc('Next')?> &raquo;</a></div>
    <? endif; ?>
    <div class="clear"></div>
  </div>
<? $pageLinks = ob_get_contents(); ?>
<? ob_end_clean(); ?>

<div class="<?=$this->layoutClass('mainbody')?>">
  <div class="resulthead">
    <form method="get" action="<?=$this->url('alphabrowse-home')?>" name="alphaBrowseForm" id="alphaBrowseForm">
      <label for="alphaBrowseForm_source"><?=$this->transEsc('Browse Alphabetically') ?></label>
      <select id="alphaBrowseForm_source" name="source">
        <? foreach ($this->alphaBrowseTypes as $key => $item): ?>
          <option value="<?=$this->escapeHtmlAttr($key) ?>"<? if ($this->source == $key): ?> selected="selected"<? endif; ?>><?=$this->transEsc($item) ?></option>
        <? endforeach; ?>
      </select>
      <label for="alphaBrowseForm_from"><?=$this->transEsc('starting from') ?></label>
      <input type="text" name="from" id="alphaBrowseForm_from" value="<?=$this->escapeHtmlAttr($this->from) ?>"/>
      <input type="submit" value="<?=$this->transEsc('Browse') ?>"/>
    </form>
  </div>

  <? if ($this->result): ?>
    <div class="alphaBrowseResult">
    <?= $pageLinks ?>

    <div class="alphaBrowseHeader"><?=$this->transEsc("alphabrowse_matches") ?></div>
      <? $altRow = false; foreach ($this->result['Browse']['items'] as $i => $item): ?>

        <? $highlight = (isset($this->highlight_row) && $i == $this->highlight_row) ? true : false ?>
        <div class="alphaBrowseEntry<? if (!($altRow = !$altRow)): echo ' alt'; endif; ?><?=$highlight ? ' browse-match' : '' ?>  alphaBrowseSource_<?=$this->escapeHtmlAttr($this->source)?>">
        <? if ($highlight && isset($this->match_type) && ($this->match_type == "NONE")): ?>
          <?// this is the right row but query doesn't match value ?>
          <?=$this->transEsc('your_match_would_be_here') ?>
          </div>
          <div class="alphaBrowseEntry<? if (!($altRow = !$altRow)): echo ' alt'; endif; ?> alphaBrowseSource_<?=$this->escapeHtmlAttr($this->source)?>">
        <? endif; ?>

        <div class="alphaBrowseHeading alphaBrowseHeading_<?=$this->escapeHtmlAttr($this->source)?>">
          <? if ($url = $this->alphabrowse()->getUrl($this->source, $item)): ?>
            <a href="<?=$this->escapeHtmlAttr($url)?>"><?=$this->escapeHtml($item['heading'])?></a>
          <? else: ?>
            <?=$this->escapeHtml($item['heading'])?>
          <? endif; ?>
        </div>
        <?
          foreach ($this->extras as $ei => $extraName):
            $extraData = $item['extras'][$extraName];
        ?>
          <div class="alphaBrowseExtra alphaBrowseColumn_<? echo $extraName?>">
            <?
              $extraDisplayArray = array();
              foreach ($extraData as $j => $e) {
                $extraDisplayArray = array_unique(array_merge($extraDisplayArray, $e));
              }
              echo (empty($extraDisplayArray)) ? '&nbsp;' : implode('<br />', $extraDisplayArray);
            ?>
          </div>
        <? endforeach; ?>
        <div class="alphaBrowseCount"><? if ($item['count'] > 0): echo $item['count']; endif; ?></div>
        <div class="clear"></div>

        <? if (count($item['useInstead']) > 0): ?>
          <div class="alphaBrowseRelatedHeading">
          <div class="title"><?=$this->transEsc('Use instead') ?>:</div>
          <ul>
            <? foreach ($item['useInstead'] as $heading): ?>
            <li><a href="<?=$this->escapeHtmlAttr($this->url('alphabrowse-home', array(), array('query' => array('from' => $heading) + $baseQuery)))?>"><?=$this->escapeHtml($heading)?></a></li>
            <? endforeach; ?>
          </ul>
          </div>
        <? endif; ?>

        <? if (count($item['seeAlso']) > 0): ?>
          <div class="alphaBrowseRelatedHeading">
          <div class="title"><?=$this->transEsc('See also') ?>:</div>
          <ul>
            <? foreach ($item['seeAlso'] as $heading): ?>
            <li><a href="<?=$this->escapeHtmlAttr($this->url('alphabrowse-home', array(), array('query' => array('from' => $heading) + $baseQuery)))?>"><?=$this->escapeHtml($heading)?></a></li>
            <? endforeach; ?>
          </ul>
          </div>
        <? endif; ?>

        <? if ($item['note']): ?>
          <div class="alphaBrowseRelatedHeading">
          <div class="title"><?=$this->transEsc('Note') ?>:</div>
          <ul>
            <li><?=$this->escapeHtml($item['note'])?></li>
          </ul>
          </div>
        <? endif; ?>

        </div>
      <? endforeach; ?>
      <? if (isset($this->highlight_end)): ?>
        <div class="alphaBrowseEntry<? if (!($altRow = !$altRow)): echo ' alt'; endif; ?> alphaBrowseSource_<?=$this->escapeHtmlAttr($this->source)?> browse-match">
          <?=$this->transEsc('your_match_would_be_here') ?>
        </div>
      <? endif; ?>

    <?= $pageLinks ?>
    </div>
  <? endif; ?>
</div>

<div class="<?=$this->layoutClass('sidebar')?>">
</div>

<div class="clear"></div>
