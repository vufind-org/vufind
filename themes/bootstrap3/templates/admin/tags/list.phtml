<?php
  // Set page title.
  $this->headTitle($this->translate('VuFind Administration - Tag Management'));
?>

<h2><?=$this->translate('Tag Management')?></h2>
<div class="<?=$this->layoutClass('mainbody')?>">
  <h3><?=$this->translate('List Tags')?></h3>

  <?=$this->render("admin/tags/menu.phtml", ['active' => 'list'])?>

  <?=$this->flashmessages()?>

  <form class="form-tags-list" action="<?= $this->url('admin/tags', array('action' => 'List'))?>" method="get">
    <h3><?=$this->translate('filter_tags')?></h3>
    <div class="tag-controls">
      <label for="user_id">
        <?=$this->translate('Username')?>
        <select name="user_id" id="user_id" class="form-control">
          <option value="ALL"><?=$this->translate('All')?></option>
          <? foreach($this->uniqueUsers as $user):?>
            <option value="<?= $user['user_id'] ?>"<? if(isset($this->params['user_id']) && $user['user_id'] == $this->params['user_id']): ?> selected="selected"<? endif;?>>
              <?=$user['username'] ?>
            </option>
          <? endforeach;?>
        </select>
      </label>
      <label for="tag_id">
        <?=$this->translate('Tag')?>
        <select name="tag_id" id="tag_id" class="form-control">
          <option value="ALL"><?=$this->translate('All')?></option>
          <? foreach($this->uniqueTags as $tag):?>
          <option value="<?= $tag['tag_id'] ?>"<? if(isset($this->params['tag_id']) && $tag['tag_id'] == $this->params['tag_id']): ?> selected="selected"<? endif;?>>
              <?=$tag['tag'] ?>
          </option>
          <? endforeach;?>
        </select>
      </label>
      <label for="resource_id">
        <?=$this->translate('Title')?>
        <select name="resource_id" id="resource_id" class="form-control">
          <option value="ALL"><?=$this->translate('All')?></option>
          <? foreach($this->uniqueResources as $resource):?>
          <option value="<?= $resource['resource_id']; ?>" title="<?=$resource['title'] ?>"<? if(isset($this->params['resource_id']) && $resource['resource_id'] == $this->params['resource_id']): ?> selected="selected"<? endif;?>>
              <?=$this->truncate($resource['title'], 80) ?> (<?=$resource['resource_id'] ?>)
          </option>
          <? endforeach;?>
        </select>
      </label>
      <label for="taglistsubmit">
        <input type="submit" id="taglistsubmit" value="<?=$this->transEsc('Filter')?>" class="btn btn-primary">
        <? if((isset($this->params['user_id']) && !is_null($this->params['user_id'])) || (isset($this->params['tag_id']) && !is_null($this->params['tag_id'])) || (isset($this->params['resource_id']) && !is_null($this->params['resource_id']))):?>
          <a href="<?= $this->url('admin/tags', array('action' => 'List')); ?>"><?=$this->translate('clear_tag_filter')?></a>
        <? endif;?>
      </label>
    </div>
  </form>

  <? if(count($this->results) > 0):?>
    <form action="<?= $this->url('admin/tags', array('action' => 'Delete'))?>" method="post">
      <input type="hidden" name="user_id" value="<?=isset($this->params['user_id']) ? $this->params['user_id'] : '' ?>" />
      <input type="hidden" name="tag_id" value="<?=isset($this->params['tag_id']) ? $this->params['tag_id'] : '' ?>" />
      <input type="hidden" name="resource_id" value="<?=isset($this->params['resource_id']) ? $this->params['resource_id'] : '' ?>" />
      <input type="hidden" name="origin" value="list" />

      <table class="table table-striped">
        <tr>
          <th><?=$this->translate('Tag')?></th>
          <th><?=$this->translate('Username')?></th>
          <th><?=$this->translate('Title')?></th>
        </tr>

        <? foreach ($this->results as $tag): ?>
          <tr>
            <td>
              <label for="<?=$this->prefix?>checkbox_<?=$tag['id']?>">
                <input id="<?=$this->prefix?>checkbox_<?=$tag['id']?>" type="checkbox" name="ids[]" value="<?=$this->escapeHtmlAttr($tag['id'])?>" class="checkbox_ui"/>
                <input type="hidden" name="idsAll[]" value="<?=$this->escapeHtmlAttr($tag['id'])?>" />
                <?=$tag->tag?> (<?= $tag->tag_id?>)
              </label>
            </td>
            <td><?=$tag->username ?> (<?= $tag->user_id?>)</td>
            <td><?=$tag->title?> (<?= $tag->resource_id?>)</td>
          </tr>
        <? endforeach;?>
      </table>

      <input type="submit" name="deleteSelected" value="<?=$this->transEsc('delete_selected')?>" class="btn btn-default">
      <input type="submit" name="deletePage" value="<?=$this->transEsc('delete_page')?>" class="btn btn-default">
      <input type="submit" name="deleteFilter" value="<?=$this->transEsc('delete_all')?>" class="btn btn-danger">

    </form>
    <?=$this->paginationControl($this->results, 'Sliding', 'Helpers/pagination.phtml', array('params' => $this->params))?>
  <? else:?>
    <p><?=$this->translate('tag_filter_empty')?></p>
  <? endif;?>
</div>

<div class="<?=$this->layoutClass('sidebar')?>">
  <?=$this->render("admin/menu.phtml")?>
</div>
