<div class="combined-search-container">
  <? $columnIndex = 0; ?>
  <? $rightColumns = []; ?>
  <div class="combined-column">
    <? foreach ($this->combinedResults as $searchClassId => $currentSearch): ?>
      <?
        $viewParams = [
          'searchClassId' => $searchClassId,
          'currentSearch' => $currentSearch,
          // Enable cart if appropriate:
          'showCartControls' => $this->supportsCartOptions[$columnIndex] && $this->showCartControls,
          // Enable bulk options if appropriate:
          'showBulkOptions' => $this->supportsCartOptions[$columnIndex] && $this->showBulkOptions
        ];
      ?>
      <?
        if (
          (!isset($currentSearch['ajax']) || !$currentSearch['ajax'])                    // AJAX column
          && (isset($currentSearch['hide_if_empty']) && $currentSearch['hide_if_empty']) // set to hide when empty
          && $currentSearch['view']->results->getResultTotal() == 0                      // and empty
        ) {
          continue;
        }
      ?>
      <? $columnIndex ++; ?>
      <?
        if ($columnIndex > 0 && $columnIndex < $columns) {
          $viewParams['domId'] = $currentSearch['domId'];
          if (isset($currentSearch['ajax'])) {
            $viewParams['ajax'] = $currentSearch['ajax'];
          }
          $rightColumns[] = $viewParams;
          continue;
        }
      ?>
      <div id="<?=$this->escapeHtmlAttr($currentSearch['domId'])?>" class="combined-list">
        <? $templateSuffix = (isset($currentSearch['ajax']) && $currentSearch['ajax']) ? 'ajax' : 'list'; ?>
        <?=$this->render('combined/results-' . $templateSuffix . '.phtml', $viewParams)?>
      </div>
    <? endforeach; ?>
  </div>
  <? foreach ($rightColumns as $colParams): ?>
    <div class="combined-column">
      <div id="<?=$this->escapeHtmlAttr($colParams['domId'])?>" class="combined-list">
        <? $templateSuffix = (isset($colParams['ajax']) && $colParams['ajax']) ? 'ajax' : 'list'; ?>
        <?=$this->render('combined/results-' . $templateSuffix . '.phtml', $colParams)?>
      </div>
    </div>
  <? endforeach; ?>
</div>
