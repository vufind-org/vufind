<?
  $this->headScript()->appendFile("openurl.js");
  if ($this->openUrlEmbed) {
    $classes = "fulltext openUrlEmbed openurl_id:{$this->openUrlId}"
      . ($this->openUrlEmbedAutoLoad ? ' openUrlEmbedAutoLoad' : '');
    $class = ' class="' . $classes . '"';
    $class_ib = ' class="imagebased ' . $classes . '"';
  } elseif ($this->openUrlWindow) {
    $classes = 'fulltext openUrlWindow window_settings:' . $this->escapeHtmlAttr($this->openUrlWindow);
    $class = ' class="' . $classes . '"';
    $class_ib = ' class="imagebased ' . $classes . '"';
  } else {
    $class = '';
    $class_ib = '';
  }
?>

<? if (!$this->openUrlImageBasedBase || $this->openUrlImageBasedMode == 'both'): ?>
<a href="<?=$this->escapeHtmlAttr($this->openUrlBase . '?' . $this->openUrl)?>"<?=$class?>>
  <? /* put the openUrl here in a span (COinS almost) so we can retrieve it later */ ?>
  <span title="<?=$this->escapeHtmlAttr($this->openUrl)?>" class="openUrl"></span>
  <? if ($this->openUrlGraphic): ?>
    <?
      $style = '';
      if ($this->openUrlGraphicWidth) {
        $style .= 'width:' . $this->escapeHtmlAttr($this->openUrlGraphicWidth) . 'px;';
      }
      if ($this->openUrlGraphicHeight) {
        $style .= 'height:' . $this->escapeHtmlAttr($this->openUrlGraphicHeight) . 'px;';
      }
    ?>
    <img src="<?=$this->escapeHtmlAttr($this->openUrlGraphic)?>" alt="<?=$this->transEsc('Get full text')?>" style="<?=$style?>" />
  <? else: ?>
    <?=$this->transEsc('Get full text')?>
  <? endif; ?>
</a>
<? endif; ?>

<? if ($this->openUrlImageBasedBase): ?>
    <a href="<?=$this->escapeHtmlAttr($this->openUrlBase . '?' . $this->openUrlImageBased)?>"<?=$class_ib?>>
        <img id="openurlimage<?=$this->driver->getUniqueId()?>" data-recordid="<?=$this->driver->getUniqueId()?>" src="<?=$this->escapeHtmlAttr($this->openUrlImageBasedBase)?>&<?=$this->escapeHtmlAttr($this->openUrlImageBased)?>" alt="<?=$this->transEsc('Get full text')?>" />
    </a>
<? endif; ?>

<? if ($this->openUrlEmbed): ?>
  <div id="openUrlEmbed<?=$this->openUrlId?>" class="resolver hidden"><?=$this->transEsc('Loading')?>...</div>
<? endif; ?>
