<?php
  // Set page title.
  $this->headTitle($this->translate('Manage Scheduled Alerts'));

  // Set up breadcrumbs:
  $this->layout()->breadcrumbs = '<li><a href="' . $this->url('myresearch-home') . '">' . $this->transEsc('Your Account') . '</a></li>'
    . '<li class="active">' . $this->transEsc('Manage Scheduled Alerts') . '</li>';

  $user = $this->auth()->getUserObject();
?>

<?=$this->component('show-account-menu-button')?>

<div class="<?=$this->layoutClass('mainbody')?>">
  <?php if ($user && !empty($user->email)): ?>
    <div class="alert alert-info alert-email-notification">
      <?=$this->transEsc('alert_email_address') . ': ' . $this->escapeHtml($user->email) ?>
      <?php if ($this->auth()->getManager()->supportsEmailChange()): ?>
        (<a href="<?=$this->url('myresearch-profile');?>"><?=$this->transEsc('edit');?></a>)
      <?php endif; ?>
    </div>
  <?php else: ?>
    <div class="alert alert-danger alert-email-notification">
      <?=$this->transEsc('no_email_address') . ' ';?><a href="<?=$this->url('myresearch-profile');?>"><?=$this->transEsc('check_profile');?></a>
    </div>
  <?php endif; ?>
  <table>
    <tr>
      <th><?=$this->transEsc('history_search')?>: </th>
      <td>
        <?php $desc = $this->results->getParams()->getDisplayQuery(); ?>
        <?=empty($desc) ? $this->transEsc('history_empty_search') : $this->escapeHtml($desc)?>
      </td>
    </tr>
    <tr>
      <th><?=$this->transEsc('history_schedule')?>: </th>
      <td>
        <?=
          $this->component(
              'menu-button',
              [
                'wrapperClass' => 'search__notify',
                'showSelectedValue' => true,
                'menuItems' => array_map(
                    function ($label, $val) {
                      return [
                        'label' => $label,
                        'url' => $this->url('myresearch-savesearch', [], ['query' => ['schedule' => $val, 'searchid' => $this->search->id]]),
                        'selected' => $this->search->notification_frequency == $val,
                      ];
                    },
                    $scheduleOptions,
                    array_keys($scheduleOptions)
                ),
              ]
          );
        ?>
      </td>
    </tr>
  </table>
</div>

<div class="<?=$this->layoutClass('sidebar')?>" id="myresearch-sidebar" role="navigation" aria-label="<?=$this->transEsc('account_menu_label')?>">
  <?=$this->accountMenu()->render('history')?>
</div>
