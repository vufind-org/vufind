<!-- START of: finna - RecordDriver/DefaultRecord/result-online-urls.phtml -->
  <?php
    $openUrl = $this->openUrl($this->driver, 'results');
    $openUrlActive = $openUrl->isActive();

    $images = $this->record($this->driver)->getAllRecordImageUrls();
    $urls = $this->driver->getURLs();
    $onlineURLs = $this->driver->tryMethod('getOnlineURLs');
    $mergedData = $this->driver->tryMethod('getMergedRecordData');

    if (!empty($images)
      && !$this->record($this->driver)->containsNonImageURL($urls, $images)
      && !$this->record($this->driver)->containsNonImageURL($onlineURLs, $images)
      && (empty($mergedData['urls']) || !$this->record($this->driver)->containsNonImageURL($mergedData['urls'], $images))
      && !$openUrlActive
    ) {
       // All online URLs are record images that are handled by image-popup
       return;
    }
    $videoScripts = $this->partial('Helpers/videojs-urls.phtml');
  ?>
  <?php if (!empty($urls) || $openUrlActive || !empty($onlineURLs) || !empty($mergedData['urls'])): ?>
    <div class="available-online-links">
      <strong class="available-online-header <?=(!empty($onlineURLs) || !empty($mergedData['urls']) || !empty($urls)) ? '' : 'hidden'; ?>"><?=$this->transEsc('Available Online') ?>:</strong>
      <div class="truncate-field">
      <?php $renderedURLs = []; ?>
      <?php if (!empty($urls)): ?>
        <?php foreach ($urls as $i => $url): ?>
          <?php
            if (isset($images[$url['url']])) {
               continue;
            } else {
               $renderedURLs[] = $url['url'];
            }
          ?>
          <?=$i > 0 ? '<br/>' : '' ?>
          <a
            class="fulltext"
            href="<?=$this->escapeHtmlAttr($this->proxyUrl($url['url'])) ?>"<?php if (!empty($url['videoSources'])): ?>
            data-video-sources="<?= $this->escapeHtmlAttr(json_encode($url['videoSources'])) ?>" data-scripts="<?=$this->escapeHtmlAttr($videoScripts)?>"<?php endif; ?><?php if (!empty($url['posterUrl'])): ?>
            data-poster-url="<?= $this->escapeHtmlAttr($url['posterUrl']) ?>"<?php endif; ?>
            <?=!empty($url['embed']) && $url['embed'] == 'video' ? ' data-embed-video' : '' ?>
            <?= $this->recordLink()->getEmbeddedVideo($url['url']) ?>
            target="_blank" title="<?=$this->escapeHtmlAttr($url['url']) ?>"><i class="fa fa-external-link"
            aria-hidden="true"
            >
            </i> <?=!empty($url['desc']) ? $this->transEsc('default::link_' . $url['desc'], null, $url['desc']) : $this->truncateUrl($url['url']) ?>
          </a>
          <?php if (!empty($url['part'])): ?> <span class="coverage"><?=$this->transEsc('default::link_' . $url['part'], null, $url['part']) ?></span><?php endif; ?>
        <?php endforeach; ?>
      <?php endif; ?>

      <?php if (!empty($onlineURLs) || !empty($mergedData['urls'])): ?>
        <?php foreach (!empty($mergedData['urls']) ? $mergedData['urls'] : $onlineURLs as $i => $url): ?>
          <?php if (isset($images[$url['url']]) || in_array($url['url'], $renderedURLs)) { continue; } ?>
          <?=count($renderedURLs) || $i > 0 ? '<br/>' : '' ?>
          <a class="fulltext" href="<?=$this->escapeHtmlAttr($this->proxyUrl($url['url'])) ?>"<?=!empty($url['embed']) && $url['embed'] == 'iframe' ? ' data-embed-iframe' : '' ?> target="_blank" title="<?=$this->escapeHtmlAttr($url['url']) ?>"><i class="fa fa-external-link" aria-hidden="true"></i> <?=!empty($url['text']) ? $this->transEsc('default::link_' . $url['text'], null, $url['text']) : $this->escapeHtml($this->truncateUrl($url['url'])) ?></a>
          <?php if (!empty($url['part'])): ?> <span class="coverage"><?=$this->transEsc('default::link_' . $url['part'], null, $url['part']) ?></span><?php endif; ?>
          <?php if ($url['source']): ?>
            <span class="online-source">(<?=is_array($url['source']) ? $this->transEsc('Multiple Organisations') : $this->transEsc('default::source_' . $url['source'], null, $url['source']) ?>)</span>
          <?php endif; ?>
        <?php endforeach; ?>
      <?php endif; ?>
      </div>
    <?php if ($openUrlActive): ?>
      <?=$openUrl->renderTemplate()?>
    <?php endif; ?>
    </div>
  <?php endif; ?>
<!-- END of: finna - RecordDriver/DefaultRecord/result-online-urls.phtml -->
